module BoundSlabs{

  message BSPopulateMsg {
    int st [];
    int sz []; 
    double facetCntrs []; 
    long long slabIDs [];
  };
 
  message BSlabsMsg{
    double cntrs []; 
    long long ids []; 
  };

  message UpdIDsMsg{
    int ids []; 
  };

  message GetBSlabsMsg;

  array [3D] BoundSlabs{
    entry BoundSlabs(int M_geom);
    entry void Populate(BSPopulateMsg * msg);

    entry void BSIterate(){
      for (iter = 1 ; iter < max_iter; iter++){
        if (expectGetBound()){
          when GetBoundSlabs[iter](GetBSlabsMsg * gmsg)
            serial { 
              SndBSlabs(gmsg);}
        }
        when UpdateSlabIDs[iter](UpdIDsMsg * umsg)
          serial{
//              CkPrintf("BS.ci 1 (%u, %u, %u)", thisIndex.x, thisIndex.y, thisIndex.z);  
              UpdSlabIDs(umsg);} 
      }
      if (expectGetBound()){
        when GetBoundSlabs[iter](GetBSlabsMsg * gmsg)
          serial { 
            SndBSlabs(gmsg);}
      }
    }

    entry void GetBoundSlabs(GetBSlabsMsg * msg);
    entry void UpdateSlabIDs(UpdIDsMsg * msg);
  };

}
